within {{project_name}}.Loads.{{ model_name }};
model building
  "Time series water mass flow rates and temperatures for a building thermal
  loads generated from Energy PLus."
  extends Modelica.Icons.Example;
  {% raw %}package MediumW=Buildings.Media.Water;
  {% endraw %}parameter String filNam="modelica://{{project_name}}/Loads/{{data['load_resources_path']}}/{{data['time_series']['filename']}}";
  {% raw %}parameter Modelica.SIunits.MassFlowRate mChW_flow_nominal=getPeakMassFlowRate(
    string="#Nominal chilled water mass flow rate",
    filNam=Modelica.Utilities.Files.loadResource(filNam))
    "Nominal cooling water flow rate"
    annotation (Dialog(group="Design parameter"));
  parameter Modelica.SIunits.MassFlowRate mHW_flow_nominal=getPeakMassFlowRate(
    string="#Nominal heating water mass flow rate",
    filNam=Modelica.Utilities.Files.loadResource(filNam))
    "Nominal heating water flow rate"
    annotation (Dialog(group="Design parameter"));
  Modelica.Blocks.Sources.CombiTimeTable buiMasTem(
    tableOnFile=true,
    tableName="modelica",
    fileName=Modelica.Utilities.Files.loadResource(
      filNam),
    extrapolation=Modelica.Blocks.Types.Extrapolation.Periodic,
    columns=2:7,
    smoothness=Modelica.Blocks.Types.Smoothness.LinearSegments)
    annotation (Placement(transformation(extent={{120,-20},{100,0}})));
  Buildings.Fluid.Sources.MassFlowSource_T supChiWat(
    redeclare package Medium=MediumW,
    use_m_flow_in=true,
    use_T_in=true,
    nPorts=1)
    "Chilled water supply"
    annotation (Placement(transformation(extent={{10,-10},{-10,10}},rotation=0,origin={30,10})));
  Buildings.Fluid.Sources.Boundary_pT buiCooSin(
    redeclare package Medium=MediumW,
    use_T_in=false,
    nPorts=1)
    "Building cooling sink."
    annotation (Placement(transformation(extent={{-10,-10},{10,10}},rotation=0,origin={-70,10})));
  Buildings.Fluid.Sources.MassFlowSource_T supHeaWat(
    redeclare package Medium=MediumW,
    use_m_flow_in=true,
    use_T_in=true,
    nPorts=1)
    "Heating water supply"
    annotation (Placement(transformation(extent={{10,-10},{-10,10}},rotation=0,origin={30,-70})));
  Buildings.Fluid.Sources.Boundary_pT buiHeaSin(
    redeclare package Medium=MediumW,
    use_T_in=false,
    nPorts=1)
    "Building heating sink."
    annotation (Placement(transformation(extent={{-10,-10},{10,10}},rotation=0,origin={-70,-70})));
  Buildings.Controls.OBC.UnitConversions.From_degC TChWR
    annotation (Placement(transformation(extent={{80,20},{60,40}})));
  Buildings.Controls.OBC.UnitConversions.From_degC THWR
    "Heating water temperature."
    annotation (Placement(transformation(extent={{80,-60},{60,-40}})));
  Modelica.Blocks.Sources.RealExpression mBuiHW(
    y=buiMasTem.y[5])
    annotation (Placement(transformation(extent={{80,-20},{60,0}})));
  Modelica.Blocks.Sources.RealExpression mBuiChW(
    y=buiMasTem.y[6])
    annotation (Placement(transformation(extent={{82,50},{62,70}})));
equation
  connect(TChWR.y,supChiWat.T_in)
    annotation (Line(points={{58,30},{46,30},{46,14},{42,14}},color={0,0,127}));
  connect(THWR.y,supHeaWat.T_in)
    annotation (Line(points={{58,-50},{58,-66},{42,-66}},color={0,0,127}));
  connect(mBuiHW.y,supHeaWat.m_flow_in)
    annotation (Line(points={{59,-10},{50,-10},{50,-62},{42,-62}},color={0,0,127}));
  connect(buiMasTem.y[1],THWR.u)
    annotation (Line(points={{99,-10},{90,-10},{90,-50},{82,-50}},color={0,0,127}));
  connect(buiMasTem.y[3],TChWR.u)
    annotation (Line(points={{99,-10},{90,-10},{90,30},{82,30}},color={0,0,127}));
  connect(mBuiChW.y,supChiWat.m_flow_in)
    annotation (Line(points={{61,60},{42,60},{42,18}},color={0,0,127}));
  annotation (
    Diagram(
      coordinateSystem(
        extent={{-100,-100},{120,100}})),
    Icon(
      coordinateSystem(
        extent={{-100,-100},{120,100}})),
    __Dymola_Commands(
      file="modelica://Buildings/Resources/Scripts/Dymola/Applications/DHC/Loads/Examples/TimeSeries_MassFlow_Temperature.mos" "Simulate and plot"),
    experiment(
      Tolerance=1e-6,
      StopTime=31534200),
    Documentation(
      info="<html>
<p>
This example connects the building side (time series CSV file generated from
energyPlus of heating/cooling water mass flow rate and temperature's)
with the district side (infinite sources of cooling and heating) through
an indirect heating and cooling energy transfer station (ETS, a heat exchanger).
</p>
</html>",
      revisions="<html>
<ul>
<li>
August 25, 2020, by Hagar Elarga:<br/>
First implementation.
</li>
</ul>
</html>"));
end building;
{% endraw %}
